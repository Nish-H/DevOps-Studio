<!DOCTYPE html>
<!-- saved from url=(0125)file:///C:/Users/nishenh/AppData/Local/Microsoft/Windows/INetCache/Content.Outlook/92D91QRY/RMS_P1_Incident_TemplateV2.0.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RMS Major Incident Notification</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --primary-color: #003d7a;
            --secondary-color: #424242;
            --border-color: #e0e0e0;
            --header-bg: linear-gradient(135deg, #003d7a 0%, #0066CC 100%);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            color: #333;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }
        
        .editable {
            border: 1px solid transparent;
            padding: 4px;
            min-height: 20px;
        }
        
        .editable:hover {
            border: 1px dashed #ccc;
            background-color: #f9f9f9;
        }
        
        .header {
            background: var(--header-bg);
            color: white;
            padding: 25px;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 120px;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .company-logo {
            width: 350px;
            height: 80px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .company-logo svg {
            width: 100%;
            height: auto;
            max-height: 100%;
        }
        
        .date-container {
            text-align: right;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            font-size: 16px;
        }
        
        .title-bar {
            background-color: var(--primary-color);
            color: white;
            padding: 18px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .basic-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            border-bottom: 1px solid var(--border-color);
        }
        
        .info-cell {
            border-right: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            padding: 12px;
            display: flex;
        }
        
        .info-cell:last-child {
            border-right: none;
        }
        
        .info-label {
            font-weight: bold;
            width: 180px;
            color: var(--secondary-color);
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            min-height: 300px;
        }
        
        .content-section {
            border-right: 1px solid var(--border-color);
            padding: 0;
            display: flex;
            flex-direction: column;
        }
        
        .content-section:last-child {
            border-right: none;
        }
        
        .section-header {
            background-color: var(--primary-color);
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
        }
        
        .section-content {
            padding: 15px;
            flex-grow: 1;
            overflow-y: auto;
        }
        
        .timeline-item {
            display: grid;
            grid-template-columns: 80px 1fr;
            margin-bottom: 10px;
            position: relative;
        }
        
        .timeline-item::after {
            content: '';
            position: absolute;
            left: 40px;
            top: 24px;
            height: calc(100% + 10px);
            width: 2px;
            background-color: #e0e0e0;
            z-index: 1;
        }
        
        .timeline-item:last-child::after {
            display: none;
        }
        
        .timeline-time {
            font-weight: bold;
            color: var(--secondary-color);
            position: relative;
            z-index: 2;
        }
        
        .timeline-time::after {
            content: '';
            position: absolute;
            right: 10px;
            top: 8px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--primary-color);
            z-index: 2;
        }
        
        .timeline-content {
            background-color: #f5f5f5;
            padding: 8px 12px;
            border-radius: 4px;
            position: relative;
            z-index: 2;
        }
        
        .buttons-container {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 15px;
            background-color: #f9f9f9;
            border-top: 1px solid var(--border-color);
            flex-wrap: wrap;
        }
        
        .action-button {
            padding: 10px 18px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .action-button:hover {
            background-color: #002a5c;
            transform: translateY(-1px);
        }
        
        .secondary-button {
            background-color: #757575;
        }
        
        .secondary-button:hover {
            background-color: #616161;
        }
        
        .save-button {
            background-color: #4caf50;
        }
        
        .save-button:hover {
            background-color: #388e3c;
        }
        
        .load-button {
            background-color: #ff9800;
        }
        
        .load-button:hover {
            background-color: #f57c00;
        }
        
        .control-panel {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            padding: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .edit-toggle {
            background-color: #4caf50;
            padding: 12px 20px;
        }
        
        .edit-toggle:hover {
            background-color: #388e3c;
        }
        
        .edit-active {
            outline: 2px dashed #4caf50;
        }
        
        .add-timeline-form {
            margin-top: 15px;
            padding: 15px;
            background-color: #f0f0f0;
            border-radius: 6px;
            display: none;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .form-group {
            flex: 1;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 12px;
            color: var(--secondary-color);
        }
        
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }
        
        .add-button {
            background-color: #4caf50;
            margin-top: 10px;
        }
        
        .add-button:hover {
            background-color: #388e3c;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            background-color: #f8f9fa;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
            position: relative;
        }
        
        .tab:hover {
            background-color: #e9ecef;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary-color);
            font-weight: bold;
            background-color: white;
            color: var(--primary-color);
        }
        
        .tab-content {
            display: none;
            padding: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .chart-wrapper {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }
        
        .risk-indicators {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .risk-indicator {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            border-radius: 8px;
            color: white;
            text-align: center;
            font-weight: bold;
        }
        
        .risk-high {
            background-color: #f44336;
        }
        
        .risk-medium {
            background-color: #ff9800;
        }
        
        .risk-low {
            background-color: #4caf50;
        }
        
        .metrics-row {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .metric-card {
            flex: 1;
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .metric-value {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
            color: var(--primary-color);
        }
        
        .metric-label {
            color: var(--secondary-color);
            font-size: 14px;
            font-weight: 500;
        }
        
        .recommendations {
            margin-top: 20px;
        }
        
        .recommendation-item {
            margin-bottom: 15px;
            padding: 20px;
            background-color: #f9f9f9;
            border-left: 4px solid var(--primary-color);
            border-radius: 0 8px 8px 0;
        }
        
        .recommendation-item h4 {
            margin-bottom: 8px;
            color: var(--secondary-color);
            font-size: 16px;
        }

        .hidden-input {
            display: none;
        }

        .status-indicator {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 8px;
        }

        .status-saved {
            background-color: #e8f5e8;
            color: #2e7d32;
        }

        .status-modified {
            background-color: #fff3e0;
            color: #f57c00;
        }
        
        /* Developer Credits - Fine Print */
        .developer-credits {
            background-color: #f8f9fa;
            border-top: 1px solid #e9ecef;
            padding: 8px 20px;
            text-align: center;
        }
        
        .developer-credits p {
            font-size: 10px;
            color: #6c757d;
            margin: 0;
            font-style: italic;
        }
        
        @media print {
            .buttons-container, .control-panel, .add-timeline-form, .developer-credits {
                display: none !important;
            }
            
            .container {
                box-shadow: none;
                max-width: 100%;
            }
            
            body {
                background-color: white;
            }
            
            .editable {
                border: none !important;
            }
            
            .editable:hover {
                border: none !important;
                background-color: transparent !important;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="incident-template">
        <div class="header">
            <div class="logo-container">
                <div class="company-logo">
                    <!-- Original First Technology KZN Logo - Embedded SVG -->
                    <svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900.000000 174.000000" preserveAspectRatio="xMidYMid meet">
                        <g transform="translate(0.000000,174.000000) scale(0.100000,-0.100000)" fill="#1976D2" stroke="none">
                            <path d="M5806 1508 c-13 -44 -26 -125 -26 -156 0 -20 -7 -62 -15 -92 -8 -30 -15 -76 -15 -101 0 -26 -7 -63 -15 -82 -8 -20 -15 -56 -15 -79 0 -24 -7 -65 -15 -92 -8 -27 -15 -62 -15 -78 0 -28 1 -28 60 -28 l59 0 6 38 c3 20 10 56 16 79 5 23 9 61 9 85 1 88 65 155 128 132 27 -10 27 -11 24 -89 -1 -44 -9 -100 -17 -125 -8 -25 -15 -61 -17 -80 l-3 -35 63 -3 62 -3 0 37 c0 20 7 62 15 94 8 32 16 101 18 154 2 87 0 97 -21 118 -19 19 -33 23 -85 23 -43 0 -71 -6 -90 -17 -14 -10 -31 -18 -37 -18 -15 0 -12 42 5 83 8 20 15 52 15 70 0 19 7 54 15 77 8 23 15 55 15 71 0 29 -1 29 -60 29 -40 0 -62 -4 -64 -12z"/>
                            <path d="M7180 1453 c-6 -37 -16 -99 -20 -138 -4 -38 -13 -86 -19 -105 -6 -19 -11 -57 -11 -85 0 -46 -15 -130 -41 -230 -6 -22 -13 -53 -16 -68 l-5 -28 63 3 64 3 8 45 c4 25 12 81 17 125 9 81 23 158 41 230 6 22 14 69 19 105 4 36 12 77 18 91 6 14 12 46 14 70 l3 44 -61 3 -61 3 -13 -68z"/>
                            <path d="M3289 1467 c-14 -12 -31 -36 -38 -54 -12 -28 -11 -37 6 -65 28 -48 74 -51 119 -7 27 26 34 41 34 72 0 69 -68 100 -121 54z"/>
                            <path d="M2868 1432 c-17 -3 -28 -51 -28 -127 0 -27 -7 -72 -15 -99 -8 -27 -15 -68 -15 -90 0 -23 -7 -66 -15 -96 -8 -30 -15 -73 -15 -95 0 -22 -7 -51 -15 -65 -31 -54 -24 -60 75 -60 l90 0 0 45 c0 24 4 66 9 92 5 26 12 64 16 84 l5 36 87 -1 87 -1 7 35 c4 19 10 50 14 68 l8 33 -86 -2 c-48 -2 -89 0 -92 3 -11 10 7 107 20 112 8 3 51 1 97 -4 46 -4 86 -5 90 -2 3 4 8 27 10 52 3 25 6 52 9 60 3 13 -21 16 -162 20 -92 3 -173 4 -181 2z"/>
                            <path d="M4624 1427 c-9 -5 -14 -24 -14 -53 l0 -45 68 3 c66 3 67 3 65 -22 -6 -67 -22 -158 -32 -183 -6 -16 -11 -47 -11 -69 0 -23 -6 -64 -14 -92 -19 -67 -34 -155 -28 -161 3 -3 34 -5 69 -5 l63 0 0 38 c1 20 7 64 15 97 8 33 15 79 15 101 0 23 7 58 15 77 8 20 15 55 15 78 0 22 7 66 16 96 l16 55 57 -6 c77 -9 100 13 92 89 -1 12 -385 14 -407 2z"/>
                            <path d="M2614 1367 c-73 -75 -118 -114 -161 -140 -18 -10 -33 -23 -33 -28 0 -5 -5 -9 -11 -9 -6 0 -37 -20 -69 -45 -32 -25 -61 -45 -64 -45 -4 0 -25 -14 -48 -30 -47 -34 -72 -82 -82 -157 -6 -51 -6 -53 17 -53 14 0 30 7 37 15 7 8 24 15 39 15 14 1 37 7 51 15 14 8 42 14 62 15 20 0 67 7 105 16 37 9 82 13 99 11 17 -3 35 -2 41 1 12 9 23 49 33 127 11 86 29 170 52 247 36 119 18 131 -68 45z"/>
                            <path d="M4156 1310 c-7 -58 -11 -66 -48 -93 -9 -7 -20 -33 -23 -59 -7 -43 -6 -47 16 -50 27 -3 27 -6 6 -138 -8 -47 -19 -98 -26 -113 -22 -55 -18 -58 66 -55 l78 3 7 40 c5 22 12 84 18 139 5 54 15 105 21 112 8 9 23 12 43 9 17 -3 36 -2 43 3 13 8 21 108 9 119 -4 4 -23 6 -43 4 -35 -3 -36 -3 -29 31 4 18 10 50 13 71 l5 37 -75 0 -74 0 -7 -60z"/>
                            <path d="M3666 1233 c-21 -9 -50 -27 -64 -40 -33 -31 -42 -29 -42 7 l0 31 -67 -3 -68 -3 -12 -100 c-11 -87 -26 -179 -49 -292 l-6 -33 75 0 c87 0 83 -5 94 125 10 127 45 177 126 181 29 1 55 3 58 3 10 2 32 108 26 125 -8 20 -21 19 -71 -1z"/>
                            <path d="M3864 1235 c-10 -8 -26 -15 -35 -15 -9 0 -25 -12 -35 -27 -10 -14 -28 -36 -39 -47 -17 -17 -20 -31 -17 -73 3 -47 8 -55 37 -73 18 -11 48 -20 67 -20 56 0 77 -40 40 -73 -25 -23 -42 -21 -103 9 -51 26 -53 26 -65 8 -19 -27 -26 -37 -47 -61 -18 -20 -17 -21 19 -44 32 -20 51 -23 133 -23 82 0 101 4 133 23 63 38 88 81 88 150 0 57 -2 60 -34 80 -18 12 -49 21 -68 21 -38 0 -58 15 -58 42 0 31 43 43 92 27 38 -12 42 -12 52 6 6 10 22 29 34 41 l24 23 -34 21 c-41 25 -153 28 -184 5z"/>
                            <path d="M3226 1213 c-3 -10 -10 -56 -16 -103 -6 -47 -16 -100 -21 -118 -9 -28 -21 -95 -31 -167 -3 -18 4 -20 66 -23 38 -2 73 1 78 6 5 5 13 51 18 103 8 82 22 167 46 287 l6 32 -70 0 c-59 0 -72 -3 -76 -17z"/>
                            <path d="M5060 1223 c-14 -2 -32 -10 -40 -17 -8 -7 -23 -16 -32 -19 -20 -7 -78 -84 -78 -102 0 -7 -7 -26 -15 -41 -37 -71 -5 -184 61 -223 54 -32 180 -30 233 4 64 40 94 74 80 91 -19 23 -95 18 -118 -8 -29 -30 -102 -31 -130 -1 -25 26 -28 81 -5 90 8 3 75 6 147 7 l132 1 3 60 c4 67 -12 108 -54 138 -25 19 -134 31 -184 20z"/>
                            <path d="M5523 1223 c-17 -2 -37 -11 -43 -19 -7 -8 -18 -14 -25 -14 -15 0 -95 -89 -95 -106 0 -7 -7 -25 -15 -40 -36 -69 -10 -165 60 -218 30 -23 43 -26 119 -26 94 0 95 1 112 68 9 36 9 45 -3 49 -7 3 -22 -2 -32 -11 -30 -27 -88 -21 -122 13 -37 38 -39 86 -4 141 35 56 65 73 117 67 102 -13 93 -17 96 32 2 24 -1 48 -6 53 -11 11 -112 18 -159 11z"/>
                            <path d="M6395 1223 c-11 -3 -28 -12 -38 -21 -17 -16 -20 -15 -32 1 -9 13 -27 17 -69 17 l-56 0 0 -45 c0 -24 -7 -70 -15 -102 -8 -31 -15 -74 -15 -94 0 -20 -7 -53 -15 -72 -8 -20 -15 -52 -15 -72 l0 -35 58 0 58 0 13 73 c7 39 16 97 19 127 11 92 50 140 112 140 39 0 51 -27 44 -98 -3 -37 -12 -87 -19 -112 -8 -25 -16 -63 -17 -85 l-3 -40 63 -3 62 -3 0 38 c0 21 7 71 16 112 8 41 16 110 17 152 2 68 -1 81 -19 99 -21 22 -107 35 -149 23z"/>
                            <path d="M6798 1223 c-20 -2 -42 -11 -48 -19 -7 -8 -18 -14 -24 -14 -14 0 -65 -54 -85 -90 -25 -43 -37 -131 -26 -180 13 -57 18 -66 66 -95 33 -21 51 -25 118 -25 96 0 144 21 198 86 64 76 85 169 54 236 -30 67 -77 98 -153 102 -35 2 -80 2 -100 -1z"/>
                            <path d="M7463 1223 c-17 -2 -37 -11 -43 -19 -7 -8 -18 -14 -24 -14 -18 0 -80 -70 -99 -113 -26 -58 -23 -169 5 -208 40 -54 76 -69 165 -69 156 0 247 86 260 246 6 72 -11 111 -66 152 -31 23 -129 35 -198 25z"/>
                            <path d="M7941 1223 c-93 -19 -159 -116 -176 -253 -6 -47 -3 -62 15 -93 31 -52 76 -77 140 -77 37 0 59 6 77 20 35 27 63 26 63 -2 0 -13 -7 -32 -15 -42 -8 -11 -15 -28 -15 -37 0 -23 -60 -59 -98 -59 -23 0 -38 9 -64 39 -28 33 -41 40 -81 44 -39 4 -49 1 -58 -14 -21 -41 19 -102 91 -139 53 -27 156 -27 209 0 46 23 121 107 121 135 1 11 7 31 15 45 8 14 14 46 15 71 0 25 7 68 15 95 8 27 15 70 15 95 0 26 7 66 15 89 26 74 23 80 -40 80 -40 0 -57 -4 -61 -15 -8 -19 -23 -19 -44 0 -18 16 -98 27 -139 18z"/>
                            <path d="M8680 1223 c-43 -4 -80 -25 -80 -46 0 -5 -13 -28 -28 -51 -15 -22 -37 -60 -48 -84 -16 -35 -23 -42 -44 -40 -22 3 -26 9 -31 58 -3 31 -11 65 -17 77 -7 12 -12 35 -12 52 l0 31 -75 0 c-41 0 -75 -4 -75 -9 0 -5 6 -22 14 -38 31 -65 65 -152 73 -193 3 -14 12 -33 20 -42 32 -37 21 -79 -45 -165 -34 -45 -62 -85 -62 -89 0 -5 -14 -23 -31 -40 -40 -41 -34 -70 12 -60 18 3 46 6 63 6 29 0 39 12 166 201 74 110 141 211 148 225 7 13 17 24 23 24 5 0 9 6 9 13 0 6 25 42 55 80 30 37 55 71 55 76 0 9 -26 22 -38 19 -4 -1 -27 -3 -52 -5z"/>
                            <path d="M2019 943 c-31 -23 -59 -40 -84 -53 -11 -6 -33 -19 -50 -30 -16 -11 -37 -22 -45 -26 -8 -3 -22 -9 -30 -14 -8 -5 -76 -39 -150 -75 -74 -37 -147 -73 -162 -81 -14 -8 -33 -14 -41 -14 -8 0 -20 -7 -27 -15 -7 -8 -23 -15 -35 -15 -12 0 -28 -7 -35 -15 -7 -8 -20 -15 -29 -15 -10 0 -26 -7 -37 -15 -10 -8 -27 -15 -36 -15 -9 0 -30 -7 -47 -15 -17 -8 -45 -22 -62 -30 -17 -8 -38 -15 -48 -15 -9 0 -26 -7 -37 -15 -10 -8 -27 -15 -37 -15 -11 0 -31 -6 -45 -14 -30 -15 -81 -33 -127 -46 -39 -11 -91 -29 -133 -46 -18 -8 -43 -14 -55 -14 -12 -1 -33 -7 -47 -15 -14 -8 -38 -14 -53 -15 -16 0 -38 -5 -50 -12 -21 -11 -38 -15 -162 -38 -33 -6 -69 -15 -80 -20 -11 -5 -33 -14 -49 -20 -21 -8 -26 -14 -19 -21 8 -8 73 -8 225 1 196 11 1162 10 1213 -1 24 -5 33 26 12 49 -59 69 -35 237 48 330 30 35 127 113 155 125 78 36 177 98 187 118 6 13 14 48 18 77 8 58 -3 66 -46 35z"/>
                            <path d="M2455 660 c-16 -4 -51 -8 -76 -9 -26 0 -63 -8 -82 -16 -20 -8 -50 -15 -66 -15 -16 0 -39 -9 -52 -19 -21 -17 -22 -22 -11 -40 6 -11 12 -29 12 -40 0 -10 7 -24 15 -31 8 -7 15 -20 15 -30 0 -10 7 -23 15 -30 8 -7 15 -17 15 -22 0 -15 85 -122 125 -157 30 -26 44 -31 73 -29 37 3 37 3 44 58 4 30 11 68 17 83 6 16 11 45 11 66 0 21 6 56 14 77 7 22 17 67 21 102 l7 62 -34 -1 c-18 -1 -46 -5 -63 -9z"/>
                            <path d="M2707 557 c-15 -10 -16 -15 -5 -30 12 -16 58 -17 752 -17 539 0 742 3 752 11 19 15 18 35 -2 43 -9 3 -345 6 -748 6 -574 0 -736 -3 -749 -13z"/>
                            <path d="M1990 515 c-7 -8 -19 -15 -27 -15 -7 0 -16 -7 -19 -15 -4 -8 -10 -15 -15 -15 -5 0 -31 -23 -58 -51 -40 -42 -50 -59 -55 -99 -4 -26 -2 -59 3 -73 l10 -26 98 5 c54 3 131 2 171 -3 88 -11 91 -4 32 73 -22 29 -40 59 -40 67 0 7 -7 22 -15 33 -8 10 -15 35 -15 54 -1 58 -10 80 -35 80 -12 0 -28 -7 -35 -15z"/>
                        </g>
                    </svg>
                </div>
            </div>
            <div class="date-container">
                <div><strong>Date:</strong></div>
                <div class="editable" contenteditable="false" id="incident-date">Wednesday 02 July 2025</div>
                <span class="status-indicator" id="save-status" style="display: none;"></span>
            </div>
        </div>
        
        <div class="title-bar">
            <div class="editable" contenteditable="false">RMS MAJOR INCIDENT NOTIFICATION</div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="main-tab">Incident Details</div>
            <div class="tab" data-tab="analysis-tab">Analysis &amp; Metrics</div>
            <div class="tab" data-tab="recommendations-tab">Recommendations</div>
        </div>
        
        <div id="main-tab" class="tab-content active">
            <div class="basic-info">
                <div class="info-cell">
                    <div class="info-label">Customer:</div>
                    <div class="editable" contenteditable="false" id="customer-name">ABC Corporation</div>
                </div>
                <div class="info-cell">
                    <div class="info-label">Site:</div>
                    <div class="editable" contenteditable="false" id="site-location">Durban Head Office</div>
                </div>
            </div>
            
            <div class="basic-info">
                <div class="info-cell">
                    <div class="info-label">Incident Number:</div>
                    <div class="editable" contenteditable="false" id="incident-number">INC-2025-001</div>
                </div>
                <div class="info-cell">
                    <div class="info-label">Incident status:</div>
                    <div class="editable" contenteditable="false" id="incident-status">INVESTIGATING</div>
                </div>
                <div class="info-cell">
                    <div class="info-label">Start Time:</div>
                    <div class="editable" contenteditable="false" id="start-time">08:30 AM</div>
                </div>
            </div>
            
            <div class="basic-info">
                <div class="info-cell">
                    <div class="info-label">Incident Manager:</div>
                    <div class="editable" contenteditable="false" id="incident-manager">John Smith</div>
                </div>
                <div class="info-cell">
                    <div class="info-label">Incident Priority:</div>
                    <div class="editable" contenteditable="false" id="incident-priority">HIGH</div>
                </div>
                <div class="info-cell">
                    <div class="info-label">Next Update Time:</div>
                    <div class="editable" contenteditable="false" id="next-update-time">10:00 AM</div>
                </div>
            </div>
            
            <div class="basic-info">
                <div class="info-cell">
                    <div class="info-label">Lead Engineer:</div>
                    <div class="editable" contenteditable="false" id="lead-engineer">Sarah Johnson</div>
                </div>
                <div class="info-cell">
                    <div class="info-label">Communication platform:</div>
                    <div class="editable" contenteditable="false" id="communication-platform">Microsoft Teams</div>
                </div>
                <div class="info-cell">
                    <div class="info-label">Is a Workaround in place?</div>
                    <div class="editable" contenteditable="false" id="workaround-status">YES</div>
                </div>
            </div>
            
            <div class="content-grid">
                <div class="content-section">
                    <div class="section-header">INCIDENT DETAILS</div>
                    <div class="section-content">
                        <div class="editable" contenteditable="false" id="incident-details">Network connectivity issues affecting multiple floors in the main building. Users experiencing intermittent connection drops and slow response times.</div>
                    </div>
                </div>
                <div class="content-section">
                    <div class="section-header">BUSINESS IMPACT</div>
                    <div class="section-content">
                        <div class="editable" contenteditable="false" id="business-impact">Approximately 150 users affected. Critical business applications experiencing degraded performance. Customer service operations partially impacted.</div>
                    </div>
                </div>
                <div class="content-section">
                    <div class="section-header">INCIDENT TIMELINE</div>
                    <div class="section-content" id="timeline-container">
                        <!-- Timeline entries will be added dynamically -->
                    <div class="timeline-item">
                    <div class="timeline-time">08:30</div>
                    <div class="timeline-content">First reports of network issues received via helpdesk</div>
                </div><div class="timeline-item">
                    <div class="timeline-time">08:35</div>
                    <div class="timeline-content">Incident escalated to Level 2 support team</div>
                </div><div class="timeline-item">
                    <div class="timeline-time">08:45</div>
                    <div class="timeline-content">Network team investigating core switch issues</div>
                </div><div class="timeline-item">
                    <div class="timeline-time">09:00</div>
                    <div class="timeline-content">Backup connection activated as temporary workaround</div>
                </div></div>
                    <div class="add-timeline-form" id="add-timeline-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="timeline-time">Time</label>
                                <input type="text" id="timeline-time" placeholder="e.g., 09:15">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="timeline-content">Event Description</label>
                                <textarea id="timeline-content" placeholder="Describe the event..."></textarea>
                            </div>
                        </div>
                        <button class="action-button add-button" onclick="addTimelineEntry()">Add Entry</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="analysis-tab" class="tab-content">
            <h3>Incident Analysis</h3>
            <div class="editable" contenteditable="false" id="incident-analysis">
                Enter incident analysis and root cause information here...
            </div>
            
            <div class="metrics-row">
                <div class="metric-card">
                    <div class="metric-label">Time to Detection</div>
                    <div class="metric-value editable" contenteditable="false" id="detection-time">12 min</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Time to Resolution</div>
                    <div class="metric-value editable" contenteditable="false" id="resolution-time">1h 42m</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Affected Systems</div>
                    <div class="metric-value editable" contenteditable="false" id="affected-systems">3</div>
                </div>
            </div>
            
            <div class="risk-indicators">
                <div class="risk-indicator risk-high">
                    <div>Business Risk</div>
                    <div class="editable" contenteditable="false" id="business-risk">HIGH</div>
                </div>
                <div class="risk-indicator risk-medium">
                    <div>Technical Risk</div>
                    <div class="editable" contenteditable="false" id="technical-risk">MEDIUM</div>
                </div>
                <div class="risk-indicator risk-low">
                    <div>Security Risk</div>
                    <div class="editable" contenteditable="false" id="security-risk">LOW</div>
                </div>
            </div>
            
            <div class="charts-container">
                <div class="chart-wrapper">
                    <div class="chart-title">Impact Distribution</div>
                    <canvas id="impactChart" height="0" style="display: block; box-sizing: border-box; height: 0px; width: 0px;" width="0"></canvas>
                </div>
                <div class="chart-wrapper">
                    <div class="chart-title">System Availability</div>
                    <canvas id="availabilityChart" height="0" style="display: block; box-sizing: border-box; height: 0px; width: 0px;" width="0"></canvas>
                </div>
            </div>
        </div>
        
        <div id="recommendations-tab" class="tab-content">
            <h3>Recommendations</h3>
            <div class="recommendations" id="recommendations-container">
                <div class="recommendation-item">
                    <h4>Immediate Actions</h4>
                    <div class="editable" contenteditable="false" id="immediate-actions">
                        List immediate actions to be taken...
                    </div>
                </div>
                <div class="recommendation-item">
                    <h4>Short-term Recommendations</h4>
                    <div class="editable" contenteditable="false" id="short-term-recs">
                        List short-term recommendations...
                    </div>
                </div>
                <div class="recommendation-item">
                    <h4>Long-term Recommendations</h4>
                    <div class="editable" contenteditable="false" id="long-term-recs">
                        List long-term recommendations...
                    </div>
                </div>
            </div>
        </div>
        
        <div class="buttons-container">
            <button class="action-button save-button" onclick="saveReport()">
                <span>💾 Save Report</span>
            </button>
            <button class="action-button load-button" onclick="loadReport()">
                <span>📂 Load Report</span>
            </button>
            <button class="action-button" onclick="toggleTimelineForm()">
                <span>➕ Add Timeline Entry</span>
            </button>
            <button class="action-button secondary-button" onclick="clearTemplate()">
                <span>🗑️ Clear Template</span>
            </button>
            <button class="action-button" onclick="exportToPDF()">
                <span>📄 Export to PDF</span>
            </button>
            <button class="action-button" onclick="exportToHTML()">
                <span>🌐 Export to HTML</span>
            </button>
            <button class="action-button" onclick="sendEmailWithAttachment()">
                <span>📧 Send Email with PDF</span>
            </button>
        </div>
        
        <!-- Developer Credits - Hidden on Export -->
        <div class="developer-credits" id="developer-credits">
            <p>Created by: Nishen Harichunder RMS nishenh@ftechkzn.co.za</p>
        </div>
    </div>
    
    <div class="control-panel">
        <button class="action-button edit-toggle" onclick="toggleEditMode()">
            <span id="edit-button-text">🔓 Enable Edit Mode</span>
        </button>
    </div>

    <input type="file" id="file-input" class="hidden-input" accept=".json" onchange="handleFileLoad(event)">
    
    <script>
        // Global variables
        let reportModified = false;
        let currentFilename = '';
        let impactChart, availabilityChart;
        let editMode = false;
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing...');
            
            // Set current date
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-GB', { 
                weekday: 'long',
                day: '2-digit', 
                month: 'long', 
                year: 'numeric'
            });
            document.getElementById('incident-date').textContent = dateStr;
            
            // Initialize tab functionality
            initializeTabs();
            
            // Initialize sample data
            initializeSampleData();
            
            // Initialize charts
            initializeCharts();

            // Setup change tracking
            setupChangeTracking();
            
            console.log('Initialization complete');
        });
        
        // Initialize tab functionality
        function initializeTabs() {
            console.log('Initializing tabs...');
            const tabs = document.querySelectorAll('.tab');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    console.log('Tab clicked:', this.dataset.tab);
                    switchTab(this, this.dataset.tab);
                });
            });
        }
        
        // Tab switching functionality
        function switchTab(tabElement, contentId) {
            console.log('Switching to tab:', contentId);
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Add active class to clicked tab
            tabElement.classList.add('active');
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show selected tab content
            const targetContent = document.getElementById(contentId);
            if (targetContent) {
                targetContent.classList.add('active');
                console.log('Tab switched successfully to:', contentId);
            } else {
                console.error('Target content not found:', contentId);
            }
        }
        
        // Setup change tracking
        function setupChangeTracking() {
            const editables = document.querySelectorAll('.editable');
            editables.forEach(el => {
                el.addEventListener('input', () => {
                    reportModified = true;
                    updateSaveStatus('modified');
                });
            });
        }
        
        // Update save status indicator
        function updateSaveStatus(status) {
            const indicator = document.getElementById('save-status');
            indicator.style.display = 'inline-block';
            
            if (status === 'saved') {
                indicator.textContent = 'Saved';
                indicator.className = 'status-indicator status-saved';
                reportModified = false;
            } else if (status === 'modified') {
                indicator.textContent = 'Modified';
                indicator.className = 'status-indicator status-modified';
            }
        }
        
        // Generate filename
        function generateFilename() {
            const customer = document.getElementById('customer-name').textContent.trim() || 'Unknown';
            const incidentNo = document.getElementById('incident-number').textContent.trim() || 'No-Number';
            const date = new Date().toISOString().split('T')[0];
            
            const cleanCustomer = customer.replace(/[^a-z0-9]/gi, '_');
            const cleanIncident = incidentNo.replace(/[^a-z0-9]/gi, '_');
            
            return `${cleanCustomer}_${cleanIncident}_${date}`;
        }
        
        // Edit mode toggle
        function toggleEditMode() {
            editMode = !editMode;
            const editables = document.querySelectorAll('.editable');
            const buttonText = document.getElementById('edit-button-text');
            
            editables.forEach(el => {
                el.contentEditable = editMode;
                if (editMode) {
                    el.classList.add('edit-active');
                } else {
                    el.classList.remove('edit-active');
                }
            });
            
            buttonText.innerHTML = editMode ? '🔒 Disable Edit Mode' : '🔓 Enable Edit Mode';
        }
        
        // Timeline functionality
        function toggleTimelineForm() {
            const form = document.getElementById('add-timeline-form');
            form.style.display = form.style.display === 'block' ? 'none' : 'block';
        }
        
        function addTimelineEntry() {
            const time = document.getElementById('timeline-time').value;
            const content = document.getElementById('timeline-content').value;
            
            if (!time || !content) {
                alert('Please fill in both time and description fields.');
                return;
            }
            
            const container = document.getElementById('timeline-container');
            const timelineItem = document.createElement('div');
            timelineItem.className = 'timeline-item';
            timelineItem.innerHTML = `
                <div class="timeline-time">${time}</div>
                <div class="timeline-content">${content}</div>
            `;
            
            container.appendChild(timelineItem);
            
            // Clear form fields
            document.getElementById('timeline-time').value = '';
            document.getElementById('timeline-content').value = '';
            
            // Hide form
            document.getElementById('add-timeline-form').style.display = 'none';
            
            // Mark as modified
            reportModified = true;
            updateSaveStatus('modified');
        }
        
        // Save report function
        function saveReport() {
            const reportData = {
                metadata: {
                    saveDate: new Date().toISOString(),
                    version: '1.0'
                },
                basicInfo: {
                    customerName: document.getElementById('customer-name').textContent,
                    siteLocation: document.getElementById('site-location').textContent,
                    incidentNumber: document.getElementById('incident-number').textContent,
                    incidentStatus: document.getElementById('incident-status').textContent,
                    startTime: document.getElementById('start-time').textContent,
                    incidentManager: document.getElementById('incident-manager').textContent,
                    incidentPriority: document.getElementById('incident-priority').textContent,
                    nextUpdateTime: document.getElementById('next-update-time').textContent,
                    leadEngineer: document.getElementById('lead-engineer').textContent,
                    communicationPlatform: document.getElementById('communication-platform').textContent,
                    workaroundStatus: document.getElementById('workaround-status').textContent
                },
                content: {
                    incidentDetails: document.getElementById('incident-details').textContent,
                    businessImpact: document.getElementById('business-impact').textContent,
                    timeline: Array.from(document.querySelectorAll('.timeline-item')).map(item => ({
                        time: item.querySelector('.timeline-time').textContent,
                        content: item.querySelector('.timeline-content').textContent
                    }))
                },
                analysis: {
                    incidentAnalysis: document.getElementById('incident-analysis').textContent,
                    detectionTime: document.getElementById('detection-time').textContent,
                    resolutionTime: document.getElementById('resolution-time').textContent,
                    affectedSystems: document.getElementById('affected-systems').textContent,
                    businessRisk: document.getElementById('business-risk').textContent,
                    technicalRisk: document.getElementById('technical-risk').textContent,
                    securityRisk: document.getElementById('security-risk').textContent
                },
                recommendations: {
                    immediateActions: document.getElementById('immediate-actions').textContent,
                    shortTermRecs: document.getElementById('short-term-recs').textContent,
                    longTermRecs: document.getElementById('long-term-recs').textContent
                }
            };
            
            const filename = generateFilename();
            currentFilename = filename;
            
            const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            updateSaveStatus('saved');
            alert(`Report saved as: ${filename}.json`);
        }
        
        // Load report function
        function loadReport() {
            if (reportModified) {
                if (!confirm('You have unsaved changes. Do you want to continue loading a new report?')) {
                    return;
                }
            }
            document.getElementById('file-input').click();
        }
        
        // Handle file load
        function handleFileLoad(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.name.endsWith('.json')) {
                alert('Please select a valid JSON report file.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const reportData = JSON.parse(e.target.result);
                    loadReportData(reportData);
                    currentFilename = file.name.replace('.json', '');
                    updateSaveStatus('saved');
                    alert('Report loaded successfully!');
                } catch (error) {
                    alert('Error loading report: Invalid file format.');
                    console.error('Load error:', error);
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }
        
        // Load report data into the form
        function loadReportData(data) {
            // Load basic info
            if (data.basicInfo) {
                document.getElementById('customer-name').textContent = data.basicInfo.customerName || '';
                document.getElementById('site-location').textContent = data.basicInfo.siteLocation || '';
                document.getElementById('incident-number').textContent = data.basicInfo.incidentNumber || '';
                document.getElementById('incident-status').textContent = data.basicInfo.incidentStatus || '';
                document.getElementById('start-time').textContent = data.basicInfo.startTime || '';
                document.getElementById('incident-manager').textContent = data.basicInfo.incidentManager || '';
                document.getElementById('incident-priority').textContent = data.basicInfo.incidentPriority || '';
                document.getElementById('next-update-time').textContent = data.basicInfo.nextUpdateTime || '';
                document.getElementById('lead-engineer').textContent = data.basicInfo.leadEngineer || '';
                document.getElementById('communication-platform').textContent = data.basicInfo.communicationPlatform || '';
                document.getElementById('workaround-status').textContent = data.basicInfo.workaroundStatus || '';
            }
            
            // Load content
            if (data.content) {
                document.getElementById('incident-details').textContent = data.content.incidentDetails || '';
                document.getElementById('business-impact').textContent = data.content.businessImpact || '';
                
                // Load timeline
                const timelineContainer = document.getElementById('timeline-container');
                timelineContainer.innerHTML = '';
                if (data.content.timeline && Array.isArray(data.content.timeline)) {
                    data.content.timeline.forEach(item => {
                        const timelineItem = document.createElement('div');
                        timelineItem.className = 'timeline-item';
                        timelineItem.innerHTML = `
                            <div class="timeline-time">${item.time}</div>
                            <div class="timeline-content">${item.content}</div>
                        `;
                        timelineContainer.appendChild(timelineItem);
                    });
                }
            }
            
            // Load analysis
            if (data.analysis) {
                document.getElementById('incident-analysis').textContent = data.analysis.incidentAnalysis || '';
                document.getElementById('detection-time').textContent = data.analysis.detectionTime || '';
                document.getElementById('resolution-time').textContent = data.analysis.resolutionTime || '';
                document.getElementById('affected-systems').textContent = data.analysis.affectedSystems || '';
                document.getElementById('business-risk').textContent = data.analysis.businessRisk || '';
                document.getElementById('technical-risk').textContent = data.analysis.technicalRisk || '';
                document.getElementById('security-risk').textContent = data.analysis.securityRisk || '';
            }
            
            // Load recommendations
            if (data.recommendations) {
                document.getElementById('immediate-actions').textContent = data.recommendations.immediateActions || '';
                document.getElementById('short-term-recs').textContent = data.recommendations.shortTermRecs || '';
                document.getElementById('long-term-recs').textContent = data.recommendations.longTermRecs || '';
            }
        }
        
        // Enhanced send email function with PDF attachment
        function sendEmailWithAttachment() {
            generatePDFForEmail().then(pdfBlob => {
                const customer = document.getElementById('customer-name').textContent || 'Unknown Customer';
                const incidentNo = document.getElementById('incident-number').textContent || 'Unknown';
                const incidentStatus = document.getElementById('incident-status').textContent || 'Unknown';
                const startTime = document.getElementById('start-time').textContent || 'Unknown';
                const incidentDetails = document.getElementById('incident-details').textContent || 'No details provided';
                const businessImpact = document.getElementById('business-impact').textContent || 'No impact details provided';
                
                const subject = `MAJOR INCIDENT NOTIFICATION - ${customer} - ${incidentNo}`;
                
                const body = `Dear Team,

Please find attached the Major Incident Notification report for your immediate attention.

INCIDENT SUMMARY:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Customer: ${customer}
Incident Number: ${incidentNo}
Current Status: ${incidentStatus}
Start Time: ${startTime}

INCIDENT DETAILS:
${incidentDetails}

BUSINESS IMPACT:
${businessImpact}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

The complete incident report is attached as a PDF document containing:
• Detailed incident timeline
• Technical analysis and metrics
• Risk assessment
• Recommendations for resolution

Please review the attached report and contact the incident manager for any questions or updates.

This is an automated notification from the RMS Incident Management System.

Best regards,
First Technology - KwaZulu-Natal (PTY) LTD
Incident Management Team`;

                // Fallback to mailto with instructions
                const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                window.open(mailtoLink);
                
                // Show instructions for manual attachment
                setTimeout(() => {
                    alert(`Email opened in your default mail client.

IMPORTANT: Please attach the PDF report manually:
1. The PDF will be automatically downloaded
2. Attach the downloaded PDF to your email before sending

Click OK to download the PDF report now.`);
                    
                    // Download the PDF for manual attachment
                    const filename = `${generateFilename()}_Report.pdf`;
                    const url = URL.createObjectURL(pdfBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 1000);
            }).catch(error => {
                console.error('Error generating PDF for email:', error);
                alert('Error generating PDF attachment. Please try exporting to PDF manually.');
            });
        }
        
        // Generate PDF specifically for email attachment
        function generatePDFForEmail() {
            return new Promise((resolve, reject) => {
                const { jsPDF } = window.jspdf;
                
                // Hide buttons and developer credits before export
                const buttonsContainer = document.querySelector('.buttons-container');
                const controlPanel = document.querySelector('.control-panel');
                const addTimelineForm = document.querySelector('.add-timeline-form');
                const developerCredits = document.querySelector('.developer-credits');
                
                buttonsContainer.style.display = 'none';
                controlPanel.style.display = 'none';
                addTimelineForm.style.display = 'none';
                developerCredits.style.display = 'none';
                
                // Remove edit-active class
                document.querySelectorAll('.edit-active').forEach(el => {
                    el.classList.remove('edit-active');
                });
                
                const template = document.getElementById('incident-template');
                
                html2canvas(template, { 
                    scale: 2,
                    useCORS: true,
                    logging: false
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/jpeg', 1.0);
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    const canvasRatio = canvas.height / canvas.width;
                    const imgWidth = pdfWidth;
                    const imgHeight = pdfWidth * canvasRatio;
                    
                    let heightLeft = imgHeight;
                    let position = 0;
                    
                    pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pdfHeight;
                    
                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pdfHeight;
                    }
                    
                    // Restore buttons and credits after export
                    buttonsContainer.style.display = 'flex';
                    controlPanel.style.display = 'flex';
                    developerCredits.style.display = 'block';
                    
                    // Return PDF as blob
                    const pdfBlob = pdf.output('blob');
                    resolve(pdfBlob);
                }).catch(error => {
                    // Restore buttons and credits on error
                    buttonsContainer.style.display = 'flex';
                    controlPanel.style.display = 'flex';
                    developerCredits.style.display = 'block';
                    reject(error);
                });
            });
        }
        
        // Export functionalities
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            
            // Hide buttons and developer credits before export
            const buttonsContainer = document.querySelector('.buttons-container');
            const controlPanel = document.querySelector('.control-panel');
            const addTimelineForm = document.querySelector('.add-timeline-form');
            const developerCredits = document.querySelector('.developer-credits');
            
            buttonsContainer.style.display = 'none';
            controlPanel.style.display = 'none';
            addTimelineForm.style.display = 'none';
            developerCredits.style.display = 'none';
            
            // Remove edit-active class
            document.querySelectorAll('.edit-active').forEach(el => {
                el.classList.remove('edit-active');
            });
            
            const template = document.getElementById('incident-template');
            
            html2canvas(template, { 
                scale: 2,
                useCORS: true,
                logging: false
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                const canvasRatio = canvas.height / canvas.width;
                const imgWidth = pdfWidth;
                const imgHeight = pdfWidth * canvasRatio;
                
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                heightLeft -= pdfHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pdfHeight;
                }
                
                const filename = `${generateFilename()}_Report.pdf`;
                pdf.save(filename);
                
                // Restore buttons and credits after export
                buttonsContainer.style.display = 'flex';
                controlPanel.style.display = 'flex';
                developerCredits.style.display = 'block';
            });
        }
        
        function exportToHTML() {
            const template = document.getElementById('incident-template');
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = template.outerHTML;
            
            // Remove control elements AND developer credits
            const controlElements = tempDiv.querySelectorAll('.buttons-container, .control-panel, .add-timeline-form, .developer-credits');
            controlElements.forEach(el => el.remove());
            
            // Remove edit-active class
            const editActives = tempDiv.querySelectorAll('.edit-active');
            editActives.forEach(el => el.classList.remove('edit-active'));
            
            // Make all editable elements non-editable for the export
            const editables = tempDiv.querySelectorAll('.editable');
            editables.forEach(el => {
                el.contentEditable = false;
            });
            
            // Create a blob and download
            const htmlContent = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <title>Incident Report - ${document.getElementById('incident-number').textContent}</title>
                    <style>
                    ${document.querySelector('style').innerHTML}
                    </style>
                </head>
                <body>
                    ${tempDiv.innerHTML}
                </body>
                </html>
            `;
            
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${generateFilename()}_Report.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Clear the template
        function clearTemplate() {
            if (confirm('Are you sure you want to clear all data from the template?')) {
                // Clear basic info
                document.getElementById('customer-name').textContent = '';
                document.getElementById('site-location').textContent = '';
                document.getElementById('incident-number').textContent = '';
                document.getElementById('incident-status').textContent = '';
                document.getElementById('start-time').textContent = '';
                document.getElementById('incident-manager').textContent = '';
                document.getElementById('incident-priority').textContent = '';
                document.getElementById('next-update-time').textContent = '';
                document.getElementById('lead-engineer').textContent = '';
                document.getElementById('communication-platform').textContent = '';
                document.getElementById('workaround-status').textContent = '';
                
                // Clear detailed sections
                document.getElementById('incident-details').textContent = '';
                document.getElementById('business-impact').textContent = '';
                
                // Clear metrics
                document.getElementById('detection-time').textContent = '';
                document.getElementById('resolution-time').textContent = '';
                document.getElementById('affected-systems').textContent = '';
                
                // Clear risk indicators
                document.getElementById('business-risk').textContent = '';
                document.getElementById('technical-risk').textContent = '';
                document.getElementById('security-risk').textContent = '';
                
                // Clear analysis and recommendations
                document.getElementById('incident-analysis').textContent = '';
                document.getElementById('immediate-actions').textContent = '';
                document.getElementById('short-term-recs').textContent = '';
                document.getElementById('long-term-recs').textContent = '';
                
                // Clear timeline entries
                document.getElementById('timeline-container').innerHTML = '';
                
                // Reset save status
                currentFilename = '';
                reportModified = false;
                document.getElementById('save-status').style.display = 'none';
                
                // Re-initialize charts with empty data
                reinitializeEmptyCharts();
            }
        }
        
        // Initialize sample data (remove in production)
        function initializeSampleData() {
            document.getElementById('customer-name').textContent = 'ABC Corporation';
            document.getElementById('site-location').textContent = 'Durban Head Office';
            document.getElementById('incident-number').textContent = 'INC-2025-001';
            document.getElementById('incident-status').textContent = 'INVESTIGATING';
            document.getElementById('start-time').textContent = '08:30 AM';
            document.getElementById('incident-manager').textContent = 'John Smith';
            document.getElementById('incident-priority').textContent = 'HIGH';
            document.getElementById('next-update-time').textContent = '10:00 AM';
            document.getElementById('lead-engineer').textContent = 'Sarah Johnson';
            document.getElementById('communication-platform').textContent = 'Microsoft Teams';
            document.getElementById('workaround-status').textContent = 'YES';
            
            document.getElementById('incident-details').textContent = 'Network connectivity issues affecting multiple floors in the main building. Users experiencing intermittent connection drops and slow response times.';
            document.getElementById('business-impact').textContent = 'Approximately 150 users affected. Critical business applications experiencing degraded performance. Customer service operations partially impacted.';
            
            // Add sample timeline
            const timelineContainer = document.getElementById('timeline-container');
            const sampleEvents = [
                { time: '08:30', content: 'First reports of network issues received via helpdesk' },
                { time: '08:35', content: 'Incident escalated to Level 2 support team' },
                { time: '08:45', content: 'Network team investigating core switch issues' },
                { time: '09:00', content: 'Backup connection activated as temporary workaround' }
            ];
            
            sampleEvents.forEach(event => {
                const timelineItem = document.createElement('div');
                timelineItem.className = 'timeline-item';
                timelineItem.innerHTML = `
                    <div class="timeline-time">${event.time}</div>
                    <div class="timeline-content">${event.content}</div>
                `;
                timelineContainer.appendChild(timelineItem);
            });
        }
        
        // Initialize charts
        function initializeCharts() {
            // Destroy existing charts if they exist
            if (impactChart) {
                impactChart.destroy();
            }
            if (availabilityChart) {
                availabilityChart.destroy();
            }
            
            // Impact Distribution Chart
            const impactCtx = document.getElementById('impactChart').getContext('2d');
            impactChart = new Chart(impactCtx, {
                type: 'pie',
                data: {
                    labels: ['Network', 'Applications', 'Servers', 'Storage', 'Security'],
                    datasets: [{
                        data: [35, 20, 25, 10, 10],
                        backgroundColor: [
                            '#003d7a',
                            '#43a047',
                            '#e53935',
                            '#fb8c00',
                            '#8e24aa'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });
            
            // System Availability Chart
            const availabilityCtx = document.getElementById('availabilityChart').getContext('2d');
            availabilityChart = new Chart(availabilityCtx, {
                type: 'bar',
                data: {
                    labels: ['F29', 'F28', 'F33', 'Main Network', 'Applications'],
                    datasets: [{
                        label: 'Availability %',
                        data: [78, 100, 95, 90, 85],
                        backgroundColor: [
                            '#e53935',
                            '#43a047',
                            '#fb8c00',
                            '#003d7a',
                            '#8e24aa'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Availability %'
                            }
                        }
                    }
                }
            });
        }
        
        // Re-initialize charts with empty data
        function reinitializeEmptyCharts() {
            // Destroy existing charts
            if (impactChart) {
                impactChart.destroy();
            }
            if (availabilityChart) {
                availabilityChart.destroy();
            }
            
            // Impact Distribution Chart
            const impactCtx = document.getElementById('impactChart').getContext('2d');
            impactChart = new Chart(impactCtx, {
                type: 'pie',
                data: {
                    labels: ['Category 1', 'Category 2', 'Category 3', 'Category 4', 'Category 5'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#003d7a',
                            '#43a047',
                            '#e53935',
                            '#fb8c00',
                            '#8e24aa'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });
            
            // System Availability Chart
            const availabilityCtx = document.getElementById('availabilityChart').getContext('2d');
            availabilityChart = new Chart(availabilityCtx, {
                type: 'bar',
                data: {
                    labels: ['System 1', 'System 2', 'System 3', 'System 4', 'System 5'],
                    datasets: [{
                        label: 'Availability %',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#e53935',
                            '#43a047',
                            '#fb8c00',
                            '#003d7a',
                            '#8e24aa'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Availability %'
                            }
                        }
                    }
                }
            });
        }
        
    </script>

</body></html>